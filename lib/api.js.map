{"version":3,"file":"api.js","names":["_interopRequireDefault","require","Object","defineProperty","exports","value","default","_superagent","_qs","_pick","_isFunction","_isEmpty","API","config","options","arguments","length","undefined","assign","pick","request","method","data","endpoint","onSuccess","onError","fileData","superagent","passedRequestHeaders","retry","requestData","requestHeaders","doRequest","superagentDefault","Error","urlRoot","isEmpty","accept","isFunction","keys","forEach","header","set","retryCount","formData","FormData","append","attibuteName","file","send","query","qs","stringify","arrayFormat","Promise","resolve","end","err","response","onRequestCompleted","ok","onRequestError","_default"],"sources":["../src/api.js"],"sourcesContent":["\"use strict\";\n\nimport superagentDefault from \"superagent\";\nimport qs from \"qs\";\nimport pick from \"lodash/pick\";\nimport isFunction from \"lodash/isFunction\";\nimport isEmpty from \"lodash/isEmpty\";\n\nconst API = {\n  config(options = {}) {\n    Object.assign(\n      this,\n      pick(options, [\"onRequestError\", \"onRequestCompleted\", \"requestData\", \"requestHeaders\", \"urlRoot\", \"superagent\"])\n    );\n  },\n\n  request(options = {}) {\n    let { method, data, endpoint, onSuccess, onError, fileData, superagent, passedRequestHeaders, retry } = options;\n    let requestData, requestHeaders, doRequest;\n    const request = superagent || this.superagent || superagentDefault;\n\n    if (!method) {\n      method = \"get\";\n    }\n    if (!data) {\n      data = {};\n    }\n    if (!endpoint) {\n      throw new Error(\"Please provide an endpoint for an API call\");\n    }\n\n    if (!onSuccess) {\n      onSuccess = (options) => {};\n    }\n\n    if (!onError) {\n      onError = (options) => {};\n    }\n\n    // set headers\n    doRequest = request[method](this.urlRoot + endpoint);\n\n    if (isEmpty(fileData)) {\n      doRequest.accept(\"json\");\n    }\n\n    if (isFunction(this.requestHeaders)) {\n      requestHeaders = this.requestHeaders();\n    } else {\n      requestHeaders = this.requestHeaders;\n    }\n    if (passedRequestHeaders) {\n      requestHeaders = { ...requestHeaders, ...passedRequestHeaders };\n    }\n\n    Object.keys(requestHeaders).forEach((header) => {\n      doRequest = doRequest.set(header, requestHeaders[header]);\n    });\n\n    // for now do not send any data except files if they are passed\n    if (!isEmpty(fileData)) {\n      // merge default requestData with object passed with this request\n      if (isFunction(this.requestData)) {\n        requestData = this.requestData();\n      } else {\n        requestData = this.requestData;\n      }\n\n      Object.assign(data, requestData);\n    }\n    const retryCount = retry ? retry : 3;\n    // just send as POST or prepare data for GET request\n    if (method === \"post\" || method === \"put\" || method === \"patch\") {\n      if (!isEmpty(fileData)) {\n        let formData = new FormData();\n        formData.append(fileData.attibuteName, fileData.file);\n        doRequest.send(formData);\n      } else {\n        doRequest.send(data);\n      }\n    } else if (method === \"get\" || method == \"del\") {\n      doRequest.retry(retryCount).query(qs.stringify(data, { arrayFormat: \"brackets\" }));\n    }\n\n    return new Promise((resolve) => {\n      // send request and act upon result\n      doRequest.end((err, response) => {\n        if (this.onRequestCompleted) this.onRequestCompleted(response);\n\n        if (!response || !response.ok) {\n          // let errors = response.body ? response.body.errors : 'Something bad happened';\n          // let statusCode = response.status;\n\n          if (this.onRequestError) this.onRequestError(response, err);\n\n          onError(response);\n        } else {\n          onSuccess(response);\n        }\n\n        /*\n          we resolve promise even if request\n          was not successful to reduce boilerplate\n          + because we typically don't want ui to\n          have some specific behaviour in this case\n         */\n\n        resolve(response);\n      });\n    });\n  },\n};\n\nexport default API;\n"],"mappings":"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"}