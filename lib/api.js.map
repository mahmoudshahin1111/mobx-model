{"version":3,"file":"api.js","names":["Object","defineProperty","exports","value","default","_superagent","_interopRequireDefault","require","_qs","_pick","_isFunction","_isEmpty","obj","__esModule","API","config","options","arguments","length","undefined","assign","pick","request","method","data","endpoint","onSuccess","onError","fileData","superagent","passedRequestHeaders","requestData","requestHeaders","doRequest","superagentDefault","Error","urlRoot","isEmpty","accept","isFunction","keys","forEach","header","set","formData","FormData","append","attibuteName","file","send","retry","query","qs","stringify","arrayFormat","Promise","resolve","end","err","response","onRequestCompleted","ok","onRequestError","_default"],"sources":["../src/api.js"],"sourcesContent":["\"use strict\";\n\nimport superagentDefault from \"superagent\";\nimport qs from \"qs\";\nimport pick from \"lodash/pick\";\nimport isFunction from \"lodash/isFunction\";\nimport isEmpty from \"lodash/isEmpty\";\n\nconst API = {\n  config(options = {}) {\n    Object.assign(\n      this,\n      pick(options, [\"onRequestError\", \"onRequestCompleted\", \"requestData\", \"requestHeaders\", \"urlRoot\", \"superagent\"])\n    );\n  },\n\n  request(options = {}) {\n    let { method, data, endpoint, onSuccess, onError, fileData, superagent, passedRequestHeaders } = options;\n    let requestData, requestHeaders, doRequest;\n    const request = superagent || this.superagent || superagentDefault;\n\n    if (!method) {\n      method = \"get\";\n    }\n    if (!data) {\n      data = {};\n    }\n    if (!endpoint) {\n      throw new Error(\"Please provide an endpoint for an API call\");\n    }\n\n    if (!onSuccess) {\n      onSuccess = (options) => {};\n    }\n\n    if (!onError) {\n      onError = (options) => {};\n    }\n\n    // set headers\n    doRequest = request[method](this.urlRoot + endpoint);\n\n    if (isEmpty(fileData)) {\n      doRequest.accept(\"json\");\n    }\n\n    if (isFunction(this.requestHeaders)) {\n      requestHeaders = this.requestHeaders();\n    } else {\n      requestHeaders = this.requestHeaders;\n    }\n    if (passedRequestHeaders) {\n      requestHeaders = { ...requestHeaders, ...passedRequestHeaders };\n    }\n\n    Object.keys(requestHeaders).forEach((header) => {\n      doRequest = doRequest.set(header, requestHeaders[header]);\n    });\n\n    // for now do not send any data except files if they are passed\n    if (!isEmpty(fileData)) {\n      // merge default requestData with object passed with this request\n      if (isFunction(this.requestData)) {\n        requestData = this.requestData();\n      } else {\n        requestData = this.requestData;\n      }\n\n      Object.assign(data, requestData);\n    }\n\n    // just send as POST or prepare data for GET request\n    if (method === \"post\" || method === \"put\" || method === \"patch\") {\n      if (!isEmpty(fileData)) {\n        let formData = new FormData();\n        formData.append(fileData.attibuteName, fileData.file);\n        doRequest.send(formData);\n      } else {\n        doRequest.send(data);\n      }\n    } else if (method === \"get\" || method == \"del\") {\n      doRequest.retry(3).query(qs.stringify(data, { arrayFormat: \"brackets\" }));\n    }\n\n    return new Promise((resolve) => {\n      // send request and act upon result\n      doRequest.end((err, response) => {\n        if (this.onRequestCompleted) this.onRequestCompleted(response);\n\n        if (!response || !response.ok) {\n          // let errors = response.body ? response.body.errors : 'Something bad happened';\n          // let statusCode = response.status;\n\n          if (this.onRequestError) this.onRequestError(response, err);\n\n          onError(response);\n        } else {\n          onSuccess(response);\n        }\n\n        /*\n          we resolve promise even if request\n          was not successful to reduce boilerplate\n          + because we typically don't want ui to\n          have some specific behaviour in this case\n         */\n\n        resolve(response);\n      });\n    });\n  },\n};\n\nexport default API;\n"],"mappings":"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"}