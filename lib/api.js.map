{"version":3,"sources":["../src/api.js"],"names":["config","warnings","longStackTraces","cancellation","API","options","Object","assign","request","method","data","endpoint","onSuccess","onError","fileData","superagent","passedRequestHeaders","requestData","requestHeaders","doRequest","Error","urlRoot","accept","keys","forEach","header","set","formData","FormData","append","attibuteName","file","send","retry","query","stringify","arrayFormat","resolve","end","err","response","onRequestCompleted","ok","onRequestError"],"mappings":"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","file":"api.js","sourcesContent":["\"use strict\";\n\nimport superagentDefault from \"superagent\";\nimport qs from \"qs\";\nimport BPromise from \"bluebird\";\n\nimport pick from \"lodash/pick\";\nimport isFunction from \"lodash/isFunction\";\nimport isEmpty from \"lodash/isEmpty\";\n\nBPromise.config({\n  warnings: true,\n  longStackTraces: true,\n  cancellation: true,\n});\n\nconst API = {\n  config(options = {}) {\n    Object.assign(\n      this,\n      pick(options, [\n        \"onRequestError\",\n        \"onRequestCompleted\",\n        \"requestData\",\n        \"requestHeaders\",\n        \"urlRoot\",\n        \"superagent\",\n      ])\n    );\n  },\n\n  request(options = {}) {\n    let {\n      method,\n      data,\n      endpoint,\n      onSuccess,\n      onError,\n      fileData,\n      superagent,\n      passedRequestHeaders\n    } = options;\n    let requestData, requestHeaders, doRequest;\n    const request = superagent || this.superagent || superagentDefault;\n\n    if (!method) {\n      method = \"get\";\n    }\n    if (!data) {\n      data = {};\n    }\n    if (!endpoint) {\n      throw new Error(\"Please provide an endpoint for an API call\");\n    }\n\n    if (!onSuccess) {\n      onSuccess = (options) => {};\n    }\n\n    if (!onError) {\n      onError = (options) => {};\n    }\n\n    // set headers\n    doRequest = request[method](this.urlRoot + endpoint);\n\n    if (isEmpty(fileData)) {\n      doRequest.accept(\"json\");\n    }\n\n    if (isFunction(this.requestHeaders)) {\n      requestHeaders = this.requestHeaders();\n    } else {\n      requestHeaders = this.requestHeaders;\n    }\n    if (passedRequestHeaders) {\n      requestHeaders = { ...requestHeaders, ...passedRequestHeaders };\n    }\n\n    Object.keys(requestHeaders).forEach((header) => {\n      doRequest = doRequest.set(header, requestHeaders[header]);\n    });\n\n    // for now do not send any data except files if they are passed\n    if (!isEmpty(fileData)) {\n      // merge default requestData with object passed with this request\n      if (isFunction(this.requestData)) {\n        requestData = this.requestData();\n      } else {\n        requestData = this.requestData;\n      }\n\n      Object.assign(data, requestData);\n    }\n\n    // just send as POST or prepare data for GET request\n    if (method === \"post\" || method === \"put\" || method === \"patch\") {\n      if (!isEmpty(fileData)) {\n        let formData = new FormData();\n        formData.append(fileData.attibuteName, fileData.file);\n        doRequest.send(formData);\n      } else {\n        doRequest.send(data);\n      }\n    } else if (method === \"get\" || method == \"del\") {\n      doRequest.retry(3).query(qs.stringify(data, { arrayFormat: \"brackets\" }));\n    }\n\n    return new BPromise((resolve) => {\n      // send request and act upon result\n      doRequest.end((err, response) => {\n        if (this.onRequestCompleted) this.onRequestCompleted(response);\n\n        if (!response || !response.ok) {\n          //let errors = response.body ? response.body.errors : 'Something bad happened';\n          //let statusCode = response.status;\n\n          if (this.onRequestError) this.onRequestError(response, err);\n\n          onError(response);\n        } else {\n          onSuccess(response);\n        }\n\n        /*\n          we resolve promise even if request\n          was not successfull to reduce boilerplat\n          + because we  typically don't want ui do\n          have some specific behaviour in this case\n         */\n\n        resolve(response);\n      });\n    });\n  },\n};\n\nexport default API;\n"]}